
# 一些优化点

## 什么时候会导致重排

- 添加、删除、更新 DOM 节点
- display: none
- 动画
- 添加或改变字号、宽高等样式
- 用户行为，比如滚动、调整窗口大小

**怎么减少重排影响呢？**

- 避免使用大量 style 属性，而是用 class
- 让动画元素脱离文档流，这样不会影响到其他的布局分层
- 能用 CSS 动画的就不要用 JS 动画
- 尽量不要用 table 布局

## 利用link标签提升渲染速度

通过rel属性进行预加载，如

```html
<link rel="dns-prefetch" href="//xx.baidu.com">
```

**rel有几个属性：**

- dns-prefetch：浏览器会对href中的域名进行DNS解析并缓存，当再次请求该域名资源时，能省去查询IP的过程，从而减少时间损耗
- prefetch/preload：都是预先下载并缓存某个资源，不同的是prefetch可能会在浏览器忙时被忽略，而preload则一定会预先下载
- preconnect：正式发送http请求前预先执行DNS解析、TCP握手、TLS协商。通过消除往返延迟来节省时间
- prerender：浏览器不仅会加载资源，还会解析执行页面，并进行预渲染


## 利用script标签提升渲染速度

由于浏览器底层运行机制，渲染引擎在解析HTML时遇到script标签引用文件是会暂停解析过程的，同时通过网络线程加载文件，文件加载后切换至js引擎执行相应代码，代码执行完成后再切换回渲染引擎继续渲染页面

可是首次渲染可能并不依赖这些js文件，这就延长了页面渲染的时间，所以为了减少这些时间损耗，可以通过script标签三个属性来实现：
- `async`：立即请求文件，但不阻塞渲染引擎，而是文件加载完毕后再阻塞渲染引擎并执行js先
- `defer`：立即请求文件，但不阻塞渲染引擎，等解析完HTML再执行js
- `H5标准的type="module"`：让浏览器按照ES6标准将文件当模板解析，默认阻塞效果和defer一样，也可以配合async在请求完成后立即执行

## href和src的区别

href是`引用`，src是`引入`

**href:**
- href引入的CSS会阻塞页面渲染，CSS加载完成才会进行渲染，所以渲染出来就是带样式的
- 不会阻塞js加载，但是会阻塞js的执行，因为js执行可能会操作DOM，所以CSS加载完之前执行js是可能会有问题的

**src:**
- src引入的js会阻塞页面的渲染(没有defer和async的情况下)，因为js很可能操作DOM修改文档结构
- 多个脚本时不会不阻塞后续资源的加载，但是会阻塞后续js逻辑的执行，按顺序执行


